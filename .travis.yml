services:
  - docker
install:
  - docker build --target test --tag todo-app:test .
script:
  - docker run todo-app:test tests
  - docker run -e TRELLO_API_KEY -e TRELLO_API_TOKEN -e TRELLO_BOARD_ID todo-app:test tests_e2e
after_success:
  - echo $DOCKER_PASSWORD | docker login --username chengjoanna1729 --password-stdin
  - docker build --target production --tag chengjoanna1729/todo-app:latest .
  - docker tag chengjoanna1729/todo-app:latest chengjoanna1729/todo-app:$TRAVIS_COMMIT
  - docker push chengjoanna1729/todo-app:latest
  - docker push chengjoanna1729/todo-app:$TRAVIS_COMMIT
before_deploy:
  - docker pull chengjoanna1729/todo-app
  - echo $HEROKU_API_KEY | docker login --username=joanna.cheng@softwire.com --password=$HEROKU_API_KEY registry.heroku.com
  - docker tag chengjoanna1729/todo-app registry.heroku.com/todo-app-joache/web
  - docker push registry.heroku.com/todo-app-joache/web
deploy:
  provider: script
  script: heroku container:release web -a todo-app-joache
  on:
    branch: master
env:
  global:
  - secure: kE7QwZ+e71kh/phmCf3qM9cRJpUTMtcxCmxhwwa/PhBcx+hPz+VcbFaQyYU7U47roNNgssDiGMnjbnAdrMllHDqbzVDXPMSFsvQRN7vpa9kiPBuoZNX453G5QLmQfMBnOX45HU9VoT9wQIEfwrHoN5qSyFIzLRwebEmrSRIuwHJXMHbHG+ePxYJC6D3Op2XSrAZmJI0h6DyV8zPG/FBi7yc/jUVfi5CVs6aCu5PbyZ0ZQLht8m2frWS/POJsCD24uqXVub25bFedhVKj0sjgcZSibGMtVPTXL4sJdr2vqy3KbykJ7a1W1cfu3lz/xvfU0TLynh/3/kTZKKlbgePhaBERfnbecRnuYqN3nMMOWAiW8BxZG1u8JKj2H9Bgz/Cai+nC5gWsEMtNSdXTlUzd3/ojXIS2K1jvxgZq1ajZiLpq9bQBzIhVskzIF9K7ejWV08B9nYv1neMBxOBYRoK9niDTwVeb/hL6x+5MMBitiiaQ7myhLWsVHQgY6fLghMRzAmCBhRcq97ROe7knCyg59c/dL6BecrObBdoieGlkR2uk/sGHRTML7lltuPCflHfbrpfUINBD0E6wtI1DqMFuI3xFS7nIZXU054RxTDBIFPgmIc7LceHKxaqGVhUz1KeuocOuMU5sR11jSxJreewOplMPVrpZryqv3XmaA4m7qEE=
  - secure: j0BzqnurFA5FtvTcFOZXjhx2YgImWDDCVnuY6St4SZUounOVJP0e4ooXpg8Q5gz6wMe7bPpefaa7FfxCUrjZ84wBgIZ4PT/HK3Zh7YU1l6oZZxah4lMVrr+vAXPISQGt5JZyS7J1AFkk/wB0JldVCg+5Y9pNmYvn0Fs5GN+MK6tCFtOLPwcdRAWhKz+xO8Qo8qxtjGSuloz0ud8+/o+H2YAf3Rz07owcIUyMyFtaonCwBOvJQzo8kXPiO13rkpDGuz49cZ2ZVnD9acHln21ZFp/X5KDL/XebzwFJipCVcFepZPEnrxbmPWpezHzblz9TU2JfgEiyiPl4vj4rdCFjcLd3gET5AdqvUeJTySPfPNnqcwcpWZql5niB5xlbKr4LtGIANoGDC3fU6fPqW0yvGPdvQdQfkfwYiUdkAeAX10N4K34iDFhM8Obj4jvCQv9TTHSPtfWPESOZZ0WZh6Nwo42DLdmJ242XL1SZlzOZ2TIsaYX1jVFPOG3IzPLiL0gTx7kQqzaU1Sy9NraaiH4fGinKmOfJ91OZLyQQmBbldwjSv6wEJ751TiwVJPQQrogEBiPR/8keJfBTuSa3BG2Ck8WfI5PhdocLKsWF80lYXcvPwpXQ8socnXoWyQWREPNPeCG7GVF0VRgwQ3UO0/ULIaY6PW1LIiLFNNqiGluMfDs=
  - secure: PXpUeavVXB8im8K1pHS/Bl5RtsCe5bksKlLtd0QyqGrey8x6FrVmM53xjG+5q0DUkss6k5hr6IPyORCB+xDn3yZpkgQUbH2FtbD/PMMEq8Nb9nV0/VeY0i8WdSf7AjJ1uwiuQknpoRWLQOQCNftoN7k563so0KTLhEgozPDuWQjo58GuFJgI77M7YsZpgjNBQHVuq0eibXCfM2ff+bhS4Tzrvf+zlVBLwa3co7ITKIRtJT4gEjbfjeNtK5oSri8yeEIrl+X7j5wfeWjySphC3aFwISuFZNDkz0nfc38vialYgC7uaXv7aluZB2H2tkD4JsR+9C/EPSVNIbH5ZgWy8Q2lbHgDJ+3Gd2DeZJJhTarGBL0mOOmIX+3ivzQb/3c+FzzeNAnHIbggrm33OqDtHegI095pNv/cSWl5RSABZldtL1+KVYEQ9+fPluy5v5c7pYeYvN0UoVeUP9289FztRx4MIiDs7F7WUJMyga3sIEimkUKg3H2XPK/dx5w7w+Qx8ORH+VgTXM2DjcGnl2dH0f8mcmZ1mzCbrhqJ18iVhzKbU+ma/NIWKRPUNBTvJWxx3PuFAMC2kmFvGY4uJGlLwrs9SnIm7UZnhpf7B+t2QLlQ8okjUpjR3y0zL+WobxNBYLPsswMAYw/CYVupRx1uDfYPgtyaCmw4ZhzJFbVFds4=
  - secure: F2xfgjhsGpnzRHQIAkakCh7J9/PZTZV9AKhLDuPURmZlSBdZ+iR2wvyWHQ97Q9wO/UMmUxuJT/b4k4LkuHEZLGSKl6pzRgg+2Prhz/MTDvTYJYwIAdfSqws0U6TqDVVLnLNNzy3az/zFhDEfztHzbcy4dzPCfGtcA46ziZtbyl28/yzjR/wQQCrl4xecfHjae5R9FF7CF2A8e9kAspjurW/s+0erXaCD49BVUd4AxT1yswhshI2MPHE4+NNPn+s9oskjUXaUmPEgg3I9vGtS5rASoLozp57Leuola1rJRZxd0TVs5nOX3Jv+5EaDECJzjNq6PcXC/JbcmBt4wt3r0UmJrOs3t9VHiPhd4/kPIHFq7rNgPpvKhwBN/aqAaTC9Jh/58HZD99LtNXO9EJR6yHtlFI8AdbAuNsj6lFGtOGDv6dQyMYYigdMKoaK3zIh6Wm9L1YFboYbTcvP2Fc0HvoH9YeLQ63wqd5VuHT92gOgNSu6/biTczdzMk8qpDcgTH2db34dwCqxIf97rNOE75VQw7EBuU2gsUPbU2TNRHml1ExmFDGl9tAlxddFDm0FIsDzWbyA6BCoK4M+f5MF/Bgm6+YJyQZr0AZrKTcpvHHs6n+FLjlf6W7Mh+GBnY7rjWU2LxF9ibepEGE+PFnaNb4ILJXg7CZmcN0nqt8z0DwE=
  - secure: dANBny9UXGQIQqcRI/rsZk2vseYSYmu6tpC+68NceZ3iOdqGQZHzJuNSFzJ2gLEtRXxtPfzLIBockaJqeCFB6jMQN/mrKwX4NLNocUWEzsCbY8xE5UbqBDISDOUA+QS/3cLCEfaAbdEu81LUnThoFwicB3xEs5W/WZ4QPXVu5GqW0QF6QMzzUcFD+YcUKnP7lGhDJz6Dz0C3rW4Rh0iRbu4Eg/f6kC5VKemZS/jQhm2bV7nmKVFRfwj+JShBAgc5n0niYFRQNiaQqptjHNl6DIED+e8Zs2ICrN/i+EG+fl+mFTBsquzUdCFfAi9Wsfl8sSeiN3MNhhoaaKSlbwui6tDCZ1GbGIwxpZgsWngc+uOW4fPmM7MoGQEUYjnIYamsqZFh3/jW69JPTinCNjwNd7tlrjBFz31eKRjvCFSpnkvjzMmYUXqVU2yLyBGElOLEBc1CvQwWc6B8+I5zfZNhdQTqapMB5Dv4MQ2Ukz6QiT2Xi/C414m+hAcvUnma8Chn8w7t+1hn97etXDJn+PjEdKdf4R2qoiyYoz7ViRf228r3R3sAmvCezOl3i+skv+uQV8TqvqSmBN23DcupoBXBOdNibpn7Pw03/FTSwhUWy58ciUKt6Yr+7wMcwpQO5ukKqfRKavxVVBNaR20zxV/EgghQqIhgEuKy5YI8cJUHcd0=
